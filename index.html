<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>City Time Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-100 min-h-screen flex items-center justify-center px-4 py-8">

  <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-lg transition">
    <h1 class="text-2xl font-bold text-center text-blue-800 mb-4">üïí City Time Converter</h1>

    <div class="text-center text-gray-700 mb-6">
      <p class="text-sm">Your Current Time (India):</p>
      <p id="currentTime" class="text-lg font-medium mt-1">Loading...</p>
    </div>

    <div class="mb-4">
      <label for="citySelect" class="block text-sm font-medium text-gray-700 mb-1">üåç Select a City:</label>
      <select id="citySelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-700">
        <option value="">Loading cities...</option>
      </select>
    </div>

    <div class="mb-4">
      <label for="datetimeInput" class="block text-sm font-medium text-gray-700 mb-1">üìÖ Select Date & Time:</label>
      <input type="datetime-local" id="datetimeInput"
             class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-700" />
    </div>

    <button onclick="convertTime()"
            class="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold py-2.5 rounded-lg shadow-md transition-all duration-200">
      üîÅ Convert Time
    </button>

    <p id="result" class="mt-6 text-center font-medium text-gray-800 text-base"></p>
  </div>

  <script>
    const citySelect = document.getElementById('citySelect');
    const result = document.getElementById('result');
    const currentTimeElem = document.getElementById('currentTime');

    function updateCurrentTime() {
      const now = new Date();
      const formatter = new Intl.DateTimeFormat('en-IN', {
        timeZone: 'Asia/Kolkata',
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        timeZoneName: 'short',
        hour12: false
      });
      currentTimeElem.textContent = formatter.format(now);
    }

    setInterval(updateCurrentTime, 1000);
    window.addEventListener('DOMContentLoaded', () => {
      updateCurrentTime();
      document.getElementById('datetimeInput').value = new Date().toISOString().slice(0, 16);
      loadTimezones();
    });

    async function loadTimezones() {
      let timezones = [];

      try {
        const resp = await fetch('https://worldtimeapi.org/api/timezone');
        if (!resp.ok) throw new Error('Primary API failed');
        timezones = await resp.json();
      } catch (e) {
        console.warn('Primary API failed, trying fallback...');
        try {
          const resp2 = await fetch('https://www.timeapi.io/api/TimeZone/AvailableTimeZones');
          if (!resp2.ok) throw new Error('Fallback API also failed');
          timezones = await resp2.json();
        } catch (err2) {
          console.error('Both APIs failed:', err2);
          citySelect.innerHTML = "<option value=''>‚ùå Failed to load cities</option>";
          return;
        }
      }

      timezones.sort((a, b) => a.localeCompare(b));
      citySelect.innerHTML = "";
      timezones.forEach(tz => {
        const opt = document.createElement('option');
        opt.value = tz;
        const parts = tz.split('/');
        const display = parts.length >= 2
          ? `${parts[1].replace(/_/g, ' ')}, ${parts[0]}`
          : tz;
        opt.textContent = display;
        citySelect.appendChild(opt);
      });

      const userTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
      if (timezones.includes(userTZ)) citySelect.value = userTZ;
    }

    function convertTime() {
      const timezone = citySelect.value;
      const datetimeInput = document.getElementById('datetimeInput').value;

      if (!timezone || !datetimeInput) {
        result.textContent = "‚ö†Ô∏è Please select a timezone and date/time.";
        return;
      }

      const localDate = new Date(datetimeInput);
      const utcDate = new Date(localDate.getTime() - localDate.getTimezoneOffset() * 60000);

      const formatter = new Intl.DateTimeFormat('en-US', {
        timeZone: timezone,
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false,
        timeZoneName: 'short'
      });

      const convertedTime = formatter.format(utcDate);
      const cityName = timezone.split('/').pop().replace(/_/g, ' ');
      result.textContent = `üïì Converted Time in ${cityName}: ${convertedTime}`;
    }
  </script>
</body>
</html>
