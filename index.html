<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>City Time Converter (Tailwind)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

  <div class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-4xl">
    <h2 class="text-4xl font-bold mb-6 text-center text-blue-600">üïí City Time Converter</h2>

    <div class="mb-6">
      <label for="citySelect" class="block text-lg font-medium text-gray-700 mb-2">üåç Select a City:</label>
      <select id="citySelect"
              class="w-full p-3 text-base border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">Loading cities...</option>
      </select>
    </div>

    <div class="mb-2">
      <label for="datetimeInput" class="block text-lg font-medium text-gray-700 mb-2">üìÖ Current Date and Time:</label>
      <p id="currentTime" class="text-xl text-gray-900 font-semibold px-2">Loading...</p>
    </div>

    <button onclick="convertTime()"
            class="mt-6 w-full text-lg bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 rounded-xl shadow-lg transition-all duration-200">
       üîÅ Convert Time
    </button>

    <p id="result" class="mt-6 text-center text-xl font-semibold text-gray-900"></p>
  </div>

  <script>
    const citySelect = document.getElementById('citySelect');
    const result = document.getElementById('result');
    const currentTimeElem = document.getElementById('currentTime');

    function updateCurrentTime() {
      const now = new Date();
      const formatter = new Intl.DateTimeFormat('en-IN', {
        timeZone: 'Asia/Kolkata',
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        timeZoneName: 'short',
        hour12: false
      });
      currentTimeElem.textContent = formatter.format(now);
    }

    setInterval(updateCurrentTime, 1000);
    window.addEventListener('DOMContentLoaded', () => {
      updateCurrentTime();
      loadTimezones();
    });

    async function loadTimezones() {
      let timezones = [];

      try {
        const resp = await fetch('https://worldtimeapi.org/api/timezone');
        if (!resp.ok) throw new Error('Primary API failed');
        timezones = await resp.json();
      } catch (e) {
        console.warn('Primary API failed, trying fallback...');
        try {
          const resp2 = await fetch('https://www.timeapi.io/api/TimeZone/AvailableTimeZones');
          if (!resp2.ok) throw new Error('Fallback API also failed');
          timezones = await resp2.json();
        } catch (err2) {
          console.error('Both APIs failed:', err2);
          citySelect.innerHTML = "<option value=''>Failed to load cities</option>";
          return;
        }
      }

      timezones.sort((a, b) => a.localeCompare(b));
      citySelect.innerHTML = "";
      timezones.forEach(tz => {
        const opt = document.createElement('option');
        opt.value = tz;
        const parts = tz.split('/');
        const display = parts.length >= 2
          ? `${parts[1].replace(/_/g, ' ')}, ${parts[0]}`
          : tz;
        opt.textContent = display;
        citySelect.appendChild(opt);
      });

      const userTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
      if (timezones.includes(userTZ)) citySelect.value = userTZ;
    }

    function convertTime() {
      const timezone = citySelect.value;

      if (!timezone) {
        result.textContent = "‚ö†Ô∏è Please select a city.";
        return;
      }

      const localDate = new Date();
      const utcDate = new Date(localDate.getTime() - localDate.getTimezoneOffset() * 60000);

      const formatter = new Intl.DateTimeFormat('en-US', {
        timeZone: timezone,
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false,
        timeZoneName: 'short'
      });

      const convertedTime = formatter.format(utcDate);
      const cityName = timezone.split('/').pop().replace(/_/g, ' ');
      result.textContent = `üïì Converted Time in ${cityName}: ${convertedTime}`;
    }
  </script>

</body>
</html>
